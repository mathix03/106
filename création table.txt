CREATE TABLE t_client (
    client_id INT PRIMARY KEY NOT NULL,
    nom VARCHAR(100) NOT NULL,
    prenom VARCHAR(100) NOT NULL,
    email VARCHAR(255) NOT NULL,
    telephone VARCHAR(20) NOT NULL
);

CREATE TABLE t_adresse (
    adresse_id INT PRIMARY KEY NOT NULL,
    client_fk INT NOT NULL,
    rue VARCHAR(255) NOT NULL,
    npa INT NOT NULL,
    localite VARCHAR(100) NOT NULL,
    zone_fk INT NULL,
    latitude FLOAT NULL,
    longitude FLOAT NULL,
    FOREIGN KEY (client_fk) REFERENCES t_client(client_id)
);

CREATE TABLE t_article (
    article_id INT PRIMARY KEY NOT NULL,
    type VARCHAR(20) NOT NULL,
    nom VARCHAR(100) NOT NULL,
    prix_ttc DECIMAL(10,2) NOT NULL,
    tva DECIMAL(4,2) NOT NULL,
    actif TINYINT NOT NULL
);

CREATE TABLE t_livreur (
    livreur_id INT PRIMARY KEY NOT NULL,
    code VARCHAR(10) NOT NULL UNIQUE,
    nom VARCHAR(100) NOT NULL,
    actif TINYINT NOT NULL
);

CREATE TABLE t_commande (
    commande_id INT PRIMARY KEY NOT NULL,
    client_fk INT NOT NULL,
    type ENUM('livraison', 'emporter', 'sur_place') NOT NULL,
    adresse_livraison_fk INT NULL,
    date_creation DATETIME NOT NULL,
    statut VARCHAR(50) NOT NULL,
    FOREIGN KEY (client_fk) REFERENCES t_client(client_id),
    FOREIGN KEY (adresse_livraison_fk) REFERENCES t_adresse(adresse_id)
);

CREATE TABLE t_ligne_commande (
    ligne_id INT PRIMARY KEY NOT NULL,
    commande_fk INT NOT NULL,
    article_fk INT NOT NULL,
    quantite INT NOT NULL,
    prix_unitaire DECIMAL(10,2) NOT NULL,
    parent_ligne_fk INT NULL,
    FOREIGN KEY (commande_fk) REFERENCES t_commande(commande_id),
    FOREIGN KEY (article_fk) REFERENCES t_article(article_id),
    FOREIGN KEY (parent_ligne_fk) REFERENCES t_ligne_commande(ligne_id)
);

CREATE TABLE t_paiement (
    paiement_id INT PRIMARY KEY NOT NULL,
    commande_fk INT NOT NULL,
    mode VARCHAR(20) NOT NULL,
    montant DECIMAL(10,2) NOT NULL,
    date_paiement DATETIME NOT NULL,
    FOREIGN KEY (commande_fk) REFERENCES t_commande(commande_id)
);

CREATE TABLE t_livraison (
    livraison_id INT PRIMARY KEY NOT NULL,
    commande_fk INT NOT NULL,
    livreur_fk VARCHAR(10) NOT NULL,
    statut VARCHAR(20) NOT NULL,
    date_depart DATETIME NULL,
    date_arrivee DATETIME NULL,
    FOREIGN KEY (commande_fk) REFERENCES t_commande(commande_id),
    FOREIGN KEY (livreur_fk) REFERENCES t_livreur(code)
);
