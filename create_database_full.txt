CREATE TABLE t_client (
    client_id INT PRIMARY KEY,
    nom VARCHAR(100),
    prenom VARCHAR(100),
    email VARCHAR(150),
    telephone VARCHAR(50)
);


CREATE TABLE t_livreur (
    livreur_id INT PRIMARY KEY,
    code VARCHAR(50) UNIQUE,
    nom VARCHAR(100),
    actif TINYINT(1)
);


CREATE TABLE t_article (
    article_id INT PRIMARY KEY,
    type VARCHAR(50),
    nom VARCHAR(150),
    prix_ttc DECIMAL(10, 2),
    tva DECIMAL(5, 2),
    actif TINYINT(1)
);


CREATE TABLE t_adresse (
    adresse_id INT PRIMARY KEY,
    client_fk INT,
    rue VARCHAR(200),
    npa INT,
    localite VARCHAR(100),
    zone_fk INT, 
    latitude DECIMAL(10, 7),
    longitude DECIMAL(10, 7),
    FOREIGN KEY (client_fk) REFERENCES t_client(client_id)
);


CREATE TABLE t_commande (
    commande_id INT PRIMARY KEY,
    client_fk INT,
    type VARCHAR(50), 
    adresse_livraison_fk INT NULL, 
    date_creation DATETIME,
    statut VARCHAR(50),
    FOREIGN KEY (client_fk) REFERENCES t_client(client_id),
    FOREIGN KEY (adresse_livraison_fk) REFERENCES t_adresse(adresse_id)
);


CREATE TABLE t_livraison (
    livraison_id INT PRIMARY KEY,
    commande_fk INT,
    livreur_fk VARCHAR(50), 
    statut VARCHAR(50),
    date_depart DATETIME,
    date_arrivee DATETIME,
    FOREIGN KEY (commande_fk) REFERENCES t_commande(commande_id),
    FOREIGN KEY (livreur_fk) REFERENCES t_livreur(code)
);


CREATE TABLE t_ligne_commande (
    ligne_id INT PRIMARY KEY,
    commande_fk INT,
    article_fk INT,
    quantite INT,
    prix_unitaire DECIMAL(10, 2),
    parent_ligne_fk INT NULL, 
    FOREIGN KEY (commande_fk) REFERENCES t_commande(commande_id),
    FOREIGN KEY (article_fk) REFERENCES t_article(article_id),
    FOREIGN KEY (parent_ligne_fk) REFERENCES t_ligne_commande(ligne_id)
);


CREATE TABLE t_paiement (
    paiement_id INT PRIMARY KEY,
    commande_fk INT,
    mode VARCHAR(50),
    montant DECIMAL(10, 2),
    date_paiement DATETIME,
    FOREIGN KEY (commande_fk) REFERENCES t_commande(commande_id)
);

LOAD DATA LOCAL INFILE 'var\lib\mysql-files\scripts\t_client.tsv'
INTO TABLE t_client
FIELDS TERMINATED BY '\t'
LINES TERMINATED BY '\n'

IGNORE 1 LINES;

LOAD DATA LOCAL INFILE 'var\lib\mysql-files\scripts\t_livreur.tsv'
INTO TABLE t_livreur
FIELDS TERMINATED BY '\t'
LINES TERMINATED BY '\n'
IGNORE 1 LINES;

LOAD DATA LOCAL INFILE 'C:\\Users\\pi86xqa\\Downloads\\samples_data\\samples_data\\t_article.tsv'
INTO TABLE t_article
FIELDS TERMINATED BY '\t'
LINES TERMINATED BY '\n'
IGNORE 1 LINES;

LOAD DATA LOCAL INFILE 'C:\\Users\\pi86xqa\\Downloads\\samples_data\\samples_data\\t_adresse.tsv'
INTO TABLE t_adresse
FIELDS TERMINATED BY '\t'
LINES TERMINATED BY '\n'
IGNORE 1 LINES;

LOAD DATA LOCAL INFILE 'C:\\Users\\pi86xqa\\Downloads\\samples_data\\samples_data\\t_commande.tsv'
INTO TABLE t_commande
FIELDS TERMINATED BY '\t'
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(commande_id, client_fk, type, @v_adresse, date_creation, statut)
SET adresse_livraison_fk = NULLIF(@v_adresse, '');

LOAD DATA LOCAL INFILE 'C:\\Users\\pi86xqa\\Downloads\\samples_data\\samples_data\\t_livraison.tsv'
INTO TABLE t_livraison
FIELDS TERMINATED BY '\t'
LINES TERMINATED BY '\n'
IGNORE 1 LINES;

LOAD DATA LOCAL INFILE 'C:\\Users\\pi86xqa\\Downloads\\samples_data\\samples_data\\t_ligne_commande.tsv'
INTO TABLE t_ligne_commande
FIELDS TERMINATED BY '\t'
LINES TERMINATED BY '\n'
IGNORE 1 LINES
(ligne_id, commande_fk, article_fk, quantite, prix_unitaire, @v_parent)
SET parent_ligne_fk = NULLIF(@v_parent, '');

LOAD DATA LOCAL INFILE 'C:\\Users\\pi86xqa\\Downloads\\samples_data\\samples_data\\t_paiement.tsv'
INTO TABLE t_paiement
FIELDS TERMINATED BY '\t'
LINES TERMINATED BY '\n'
IGNORE 1 LINES;